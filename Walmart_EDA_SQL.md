# Python Download data and clean 
## üì§ Load dependencies
```python
import pandas as pd
import numpy as np
```
```python
import warnings
warnings.filterwarnings('ignore', category=FutureWarning)
```
## üì§Load data
```python
data = pd.read_csv('/content/Walmart.csv')
data.head()
```
![image](https://github.com/user-attachments/assets/7ac84224-693c-467b-995c-5f8c010e447d)
## üí° Understand the data
```python
data.info()
```
![image](https://github.com/user-attachments/assets/90303f4d-d6af-491f-ac63-0f2fb62f6a16)

OBSERVATIONS:
- `unit_price` and `quantity` both have 31 missing values.
- `unit_price` should be of type float64.

```python
# Snapshot of the distribution and central tendency of numerical variables
data.describe()
```
![image](https://github.com/user-attachments/assets/8cbec327-5d8c-4f88-9db8-f529960942df)

OBSERVATIONS:
- The majority of the ratings are below 7 and quantities are below 3.

```python
# Check for duplicates
data.duplicated().sum()
```
![image](https://github.com/user-attachments/assets/2be75359-8e49-4d72-9229-09fea34df333)

# üßπ Data Cleaning
```python
# Drop all duplicate records
data.drop_duplicates(inplace=True)
```
*Since the goal is to accurately describe past data, removing rows or columns with missing values is a practical approach.*
```python
# Drop all records with missing values
data.dropna(inplace=True)
# Verify that there are no more missing values
data.isnull().sum().any()
```
![image](https://github.com/user-attachments/assets/d98fca5c-151a-4ce4-940d-c6a9a4376bec)
```python
# Convert all column names to lowercase for consistency
data.columns = [col.lower() for col in data.columns.to_list()]
```
```python
data.columns
```
![image](https://github.com/user-attachments/assets/db9bcadf-423d-45e9-bd7b-886bf9ca8092)
```python
# Convert date to dtype datetime
data['date'] = pd.to_datetime(data['date'], format='%d/%m/%y')
```
```python
# Remove dollar sign from unit_price
data['unit_price'] = data['unit_price'].str.replace('$', '')

# Change data type of unit_price to float
data['unit_price'] = data['unit_price'].astype('float64')

# Count of records
data.shape[0]
```
![image](https://github.com/user-attachments/assets/41cf5af9-ed11-46bd-95d2-6fc0c4b451ef)

```python
# Create a new column
data['total_revenue'] = data['unit_price'] * data['quantity']
```
```python
df = data.copy()
# Export clean data to csv
df.to_csv('walmart_cleaned.csv', index=False)
```

# SQL Queries
## Data imported to PSQL
```sql
SELECT * FROM walmart;
```
![image](https://github.com/user-attachments/assets/c3c7488e-b4d1-4ff7-a0e8-f5e37ba27e6d)

## üîç Exploratory Data Analysis

<b> How many transactions are there?</b>
```sql
SELECT 
 COUNT(*) AS nr_of_transactions
FROM walmart;
```
![image](https://github.com/user-attachments/assets/55571d53-5397-429b-8a9f-1e0a812a7d17)

<b> How many store branches do we have?</b>
```sql
SELECT 
 COUNT(DISTINCT branch) AS total_branches
FROM walmart;
```
![image](https://github.com/user-attachments/assets/8d6a5401-f3ce-474a-9b00-1305cfcbadfd)

<b> What is the minimum and maximum quantity of items sold?</b>
```sql
SELECT 
 MIN(quantity) AS min_quantity_sold,
 MAX(quantity) AS max_quantity_sold
FROM walmart;
```
![image](https://github.com/user-attachments/assets/cc88f953-2500-4a9d-8f9b-7cfd83789d50)

<b> How many transaction were made for each payment method?</b>
```sql
SELECT 
 payment_method,
 COUNT(*) AS nr_of_transactions
FROM walmart
GROUP BY 1;
```
![image](https://github.com/user-attachments/assets/199c8f82-e98d-4433-a2cb-a4b5dcd774b7)
```python
## Total transactions by payment method
ax =sns.countplot(x='payment_method', data=df, hue='payment_method')

# Iterate over each bar and display the count value above it
for p in ax.patches:
    ax.annotate(f'{p.get_height()}', (p.get_x() + p.get_width() / 2., p.get_height()),
                ha='center', va='center', xytext=(0, 5), textcoords='offset points')
    
plt.show()
```
![image](https://github.com/user-attachments/assets/64ad7463-2154-407a-be27-d6573fec0a05)


## Solving Business Problems
### Revenue 
<b> ‚ùì Calculate the total revenue generated by each branch.</b>
```sql
SELECT 
	branch,
	ROUND(SUM(total_revenue)::NUMERIC,2) AS total_branch_revenue
FROM walmart
GROUP BY 1
ORDER BY 1;
```
![image](https://github.com/user-attachments/assets/f2afd552-8498-4a47-91de-5b06e8c16f33)


<b> ‚ùìIdentify the top 3 cities with the highest total revenue.</b>
```sql
SELECT 
 city,
 ROUND(SUM(total_revenue)::NUMERIC, 2) AS total_cty_revenue
FROM walmart
GROUP BY 1
ORDER BY 2 DESC
LIMIT 3;
```
![image](https://github.com/user-attachments/assets/84bc8f5b-5981-4b26-b6fc-8f8d82fe4d67)


<b> ‚ùì Calculate the total revenue generated for each month.</b>
```sql
SELECT 
	EXTRACT(MONTH from date) AS mnth_nr,
	TO_CHAR(date, 'Month') AS month,
	ROUND(SUM(total_revenue)::NUMERIC, 2) AS daily_total_revenue
FROM walmart
GROUP BY 1, 2
ORDER BY 1;
```
![image](https://github.com/user-attachments/assets/221d3629-35be-433f-9288-08968965221e)


<b> ‚ùì Find the branch with the highest total revenue for the "Health and beauty" category.</b>
```sql
SELECT 
	branch,
	city,
	ROUND(SUM(total_revenue)::NUMERIC, 2) AS branch_total_revenue
FROM walmart
WHERE category = 'Health and beauty'
GROUP BY 1, 2
ORDER BY 3 DESC
LIMIT 1;
```
![image](https://github.com/user-attachments/assets/3c6c9f9c-ad15-4203-a7e5-b2433e2659f7)

### Profits
<b> ‚ùì Calculate the average profit margin for each payment method.</b>
```sql
SELECT 
	payment_method,
	ROUND(AVG(profit_margin)::NUMERIC,2) AS avg_profit_payment_method
FROM walmart
GROUP BY 1
ORDER BY 2 DESC;
```
![image](https://github.com/user-attachments/assets/26186197-2beb-47d7-9b81-65a1c2f737af)


<b> ‚ùìCalculate the total net profit for each category.</b>
```sql
SELECT 
	category,
	ROUND(SUM(total_revenue * profit_margin)::NUMERIC, 2) AS category_net_profit
FROM walmart
GROUP BY 1
ORDER BY 2 DESC;
```
![image](https://github.com/user-attachments/assets/583484a1-6e6d-400b-b70e-11b51dbb95ce)


### Ratings
<b> ‚ùìDetermine the average , minimum and maximum rating of products for each city.</b>
```sql
SELECT 
	city,
	category,
	MIN(rating) AS min_rating,
	ROUND(AVG(rating)::NUMERIC, 2) AS avg_rating,
	MAX(rating) AS max_rating
FROM walmart
GROUP BY 1, 2
ORDER BY 1, 2;
```
![image](https://github.com/user-attachments/assets/00f38190-073f-45c2-825b-81ad439d3149)


<b> ‚ùìIdentify the highest-rated category in each branch. Display the branch, category and average rating.</b>
```sql
SELECT
    branch,
    category,
    ROUND(avg_rating::NUMERIC, 2)
FROM (
    SELECT
        branch,
        category,
        AVG(rating) AS avg_rating,
        RANK() OVER (
            PARTITION BY branch
            ORDER BY AVG(rating) DESC
        ) AS rnk
    FROM walmart
    GROUP BY branch, category
) AS subquery
WHERE rnk = 1;
```
![image](https://github.com/user-attachments/assets/a35dabbe-6439-4405-bcc6-40289acdb08a)

### Payments
<b> ‚ùì Find the different payment methods their total number of transactions and total quantities sold.</b>
```sql
SELECT 
 payment_method,
 COUNT(*) AS nr_of_transactions,
 SUM(quantity) AS quantity_sold
FROM walmart
GROUP BY 1;
```
![image](https://github.com/user-attachments/assets/788bd8ba-2c3e-4327-b27c-1974dda4562c)


<b> ‚ùì Determine the most common payment method for each Branch.</b>
```sql
SELECT
	branch,
	payment_method
FROM (
	SELECT 
		branch,
		payment_method,
		COUNT(payment_method),
		RANK()OVER(
			PARTITION BY branch
			ORDER BY COUNT(payment_method) DESC
		)AS rnk
	FROM walmart
	GROUP BY 1, 2
)
WHERE rnk = 1
ORDER BY 1;
```
![image](https://github.com/user-attachments/assets/a05dc569-9784-4e5c-bb03-562324a5f5d6)


### Sales Trends
<b> ‚ùìIdentify the busiest day of the week for each branch based on the number of transactions.</b>
``` sql
SELECT
 branch,
 day_name,
 nr_of_transactions
FROM (
 SELECT
  branch,
  TO_CHAR(date, 'Day') AS day_name,
  COUNT(*) AS nr_of_transactions,
  RANK()OVER(
    PARTITION BY branch
    ORDER BY COUNT(*) DESC 
 )AS rnk
 FROM walmart
 GROUP BY 1, 2
)
WHERE rnk = 1;
```
![image](https://github.com/user-attachments/assets/2a36828d-6c3f-421a-bacd-8631740eab61)


<b> ‚ùì How many transactions were completed in each shift (Morning, Afternoon, Evening) for each branch at Walmart?</b>
```sql
SELECT
	branch,
	CASE
		WHEN time BETWEEN '06:00:00' AND '11:59:59' THEN 'Morning'
		WHEN time BETWEEN '12:00:00' AND '17:59:59' THEN 'Afternoon'
		WHEN time BETWEEN '18:00:00' AND '23:59:59' THEN 'Evening'
	END AS shift,
	COUNT(*) AS nr_of_transactions
FROM walmart
GROUP BY 1, 2
ORDER BY 1, 3 DESC;
```
![image](https://github.com/user-attachments/assets/801e8046-dfe9-4015-a7d4-19a581760e42)

<b> ‚ùìDetermine the top 5 branches that experienced the greatest percentage decrease in revenue from 2022 to 2023.</b>
```sql
WITH yearly_revenue AS (
	SELECT
		branch,
		EXTRACT(YEAR from date) AS year,
		SUM(total_revenue) AS total_revenue
	FROM walmart
	GROUP BY 1, 2
	ORDER BY 1
), compare_revenues AS(
	SELECT 
		r1.branch,
		r1.total_revenue AS total_revenue_2022,
		r2.total_revenue AS total_revenue_2023,
		ROUND(((r1.total_revenue - r2.total_revenue) / r1.total_revenue)::NUMERIC * 100 , 2) AS percent_decrease
	FROM( SELECT * FROM yearly_revenue WHERE year = 2022) AS r1
	JOIN( SELECT * FROM yearly_revenue WHERE year = 2023) AS r2
		ON r1.branch = r2.branch
)

SELECT *
FROM compare_revenues
WHERE percent_decrease > 0
ORDER BY percent_decrease DESC
LIMIT 5;
```
![image](https://github.com/user-attachments/assets/719551f6-713b-459d-aca1-0f940c206e6b)
